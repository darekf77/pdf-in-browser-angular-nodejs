"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var tnp_core_1 = require("tnp-core");
var tnp_helpers_1 = require("tnp-helpers");
var node_cli_tester_backend_1 = require("./node-cli-tester.backend");
function run(argsv, instance) {
    if (instance === void 0) { instance = node_cli_tester_backend_1.NodeCliTester.Instance(); }
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var command, _a, _b, _i, key, argsToPass;
        return tslib_1.__generator(this, function (_c) {
            switch (_c.label) {
                case 0:
                    command = argsv.shift().toLowerCase();
                    _a = [];
                    for (_b in instance)
                        _a.push(_b);
                    _i = 0;
                    _c.label = 1;
                case 1:
                    if (!(_i < _a.length)) return [3 /*break*/, 4];
                    key = _a[_i];
                    if (!(key.toLowerCase() === command && tnp_core_1._.isFunction(instance[key]))) return [3 /*break*/, 3];
                    argsToPass = argsv
                        .filter(function (a) { return !a.startsWith('--'); })
                        .map(function (a) { return parseArr(a); });
                    return [4 /*yield*/, tnp_helpers_1.Helpers.runSyncOrAsync.apply(tnp_helpers_1.Helpers, tslib_1.__spreadArrays([[key, instance]], argsToPass))];
                case 2:
                    _c.sent();
                    _c.label = 3;
                case 3:
                    _i++;
                    return [3 /*break*/, 1];
                case 4:
                    process.exit(0);
                    return [2 /*return*/];
            }
        });
    });
}
exports.run = run;
function parseArr(a) {
    if (a === 'null') {
        return null;
    }
    if (a.startsWith('[') && a.endsWith(']')) {
        var elems = a.slice(1, a.length - 1).split(',');
        return elems;
    }
    return a;
}
//# sourceMappingURL=start.backend.js.map