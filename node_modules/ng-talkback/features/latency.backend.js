"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var options_backend_1 = require("../options.backend");
var Latency = /** @class */ (function () {
    function Latency(options) {
        this.options = options;
    }
    Latency.prototype.simulate = function (req, tape) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var resolved, latencyGenerator, latency, type, high, low;
            return tslib_1.__generator(this, function (_a) {
                resolved = Promise.resolve();
                latencyGenerator = tape && tape.meta.latency !== undefined ? tape.meta.latency : this.options.latency;
                if (!latencyGenerator) {
                    return [2 /*return*/, resolved];
                }
                options_backend_1.default.validateLatency(latencyGenerator);
                latency = 0;
                type = typeof latencyGenerator;
                if (type === "number") {
                    latency = latencyGenerator;
                }
                else if (Array.isArray(latencyGenerator)) {
                    high = latencyGenerator[1];
                    low = latencyGenerator[0];
                    latency = Math.random() * (high - low) + low;
                }
                else {
                    latency = latencyGenerator(req);
                }
                return [2 /*return*/, new Promise(function (r) { return setTimeout(r, latency); })];
            });
        });
    };
    return Latency;
}());
exports.default = Latency;
//# sourceMappingURL=latency.backend.js.map